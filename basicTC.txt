#!/bin/bash
echo "setting up enviroment"
echo "make sure newlib source file is named as newlib" 

cd gcc-5.3.0
ln -s ../mpfr-3.1.3 mpfr
ln -s ../gmp-6.1.0 gmp
ln -s ../mpc-1.0.3 mpc
ln -s ../isl-0.15 isl
ln -s ../cloog-0.18.1 cloog
cd ..
export target=x86_64-linux-gnu
export PREFIX=~/x86_64-gcc5.3.0/$TARGET
export PATH=$PATH:$PREFIX/bin
echo "done"
echo "installing binutils"
mkdir build-binutils
cd build-binutils
../binutils-2.26/configure --target=$TARGET --prefix=$PREFIX --disable-multilib
export PREFIX=/home/sayeed/toolchain/sayeed/$TARGET
../binutils-2.26/configure --target=$TARGET --prefix=$PREFIX --disable-multilib
make -j4
make install
cd ..
echo "installing gcc"
mkdir build-gcc
cd build-gcc
../gcc-5.3.0/configure --target=$TARGET --prefix=$PREFIX --without-headers --with-newlib  --with-gnu-as --with-gnu-ld --enable-languages=c,c++ --disable-multilib
make -j4 all-gcc
make install-gcc
cd ..
echo "installing newlib"
mkdir build-newlib
ls
cd build-newlib
../newlib/configure --target=$TARGET --prefix=$PREFIX
make -j4 all
make install
cd ..
rm -rf build-gcc
echo "installing gcc with newlib"
mkdir build-gcc
cd build-gcc
../gcc-5.3.0/configure --target=$TARGET --prefix=$PREFIX --with-newlib  --with-gnu-as --with-gnu-ld --enable-languages=c,c++ --disable-multilib --enable-shared --disable-libssp
make -j4 all
make install
cd ..
echo "all done"
echo "finishing up"
cd ~/x86_64-gcc5.3.0/bin
for f in * ; do mv "$f" "x86_64-linux-$f" ; done
echo "toolchain ready"
