#!/bin/bash
echo "setting up enviroment"
echo "make sure newlib source file is named as newlib" 

cd gcc-5.3.1
ln -s ../mpfr-3.1.4 mpfr
ln -s ../gmp-6.1.0 gmp
ln -s ../mpc-1.0.3 mpc
ln -s ../isl-0.17 isl
ln -s ../cloog-0.18.4 cloog
ln -s ../gdb-7.9 gdb
ln -s ../ppl-1.2 ppl
cd ..

export TARGET=x86_64-linux-gnu
export PREFIX=/home/cyborg/zenfone/toolchian6/intel/$TARGET
export PATH=$PATH:$PREFIX/bin

echo "done"
echo "installing binutils"

mkdir build-binutils

cd build-binutils
../binutils-2.26/configure --target=$TARGET --prefix=$PREFIX  --with-tune=intel --with-arch=x86-64 --with-fpmath=sse --with-sysroot=/home/cyborg/zenfone/androtoolx86/sysroot --with-multilib-list=m32,m64,mx32 --program-transform-name='s&^&x86_64-linux-android-&' --disable-option-checking

make -j4
make install
cd ..

echo "installing gcc"
mkdir build-gcc
cd build-gcc

../gcc-5.3.1/configure --target=$TARGET --prefix=$PREFIX --with-gnu-as --with-gnu-ld --with-libs= --enable-languages=c,c++ --enable-cloog-backend=isl --with-host-libstdcxx='-static-libgcc -Wl,-Bstatic,-lstdc++,-Bdynamic -lm' --disable-libssp --enable-threads --disable-nls --disable-libmudflap --disable-libgomp --disable-libstdc__-v3 --disable-sjlj-exceptions --disable-shared --disable-tls --disable-libitm --with-arch=x86-64 --with-tune=intel --with-fpmath=sse --with-multilib-list=m32,m64,mx32 --enable-initfini-array --disable-nls --with-sysroot=/home/cyborg/zenfone/androtoolx86/sysroot --with-python --with-bugurl=sayeed.afridi2009@gmail.com --disable-bootstrap --enable-plugins --enable-libgomp --enable-gnu-indirect-function --disable-libcilkrts --disable-libsanitizer --enable-gold --enable-threads --enable-graphite=yes --enable-eh-frame-hdr-for-static --enable-gold=default --program-transform-name='s&^&x86_64-linux-android-&' --disable-option-checking

make -j4 all-gcc
make install-gcc
cd ..

echo "installing newlib"
mkdir build-newlib


cd build-newlib
../newlib/configure --target=$TARGET --prefix=$PREFIX --program-transform-name='s&^&x86_64-linux-android-&'

make -j4 all
make install
cd ..

rm -rf build-gcc
echo "installing gcc with newlib"
mkdir build-gcc
cd build-gcc


../gcc-5.3.1/configure --target=$TARGET --prefix=$PREFIX --with-gnu-as --with-gnu-ld --with-newlib --enable-languages=c,c++ --enable-cloog-backend=isl --with-host-libstdcxx='-static-libgcc -Wl,-Bstatic,-lstdc++,-Bdynamic -lm' --disable-libssp --enable-threads --disable-nls --disable-libmudflap --disable-libgomp --disable-libstdc__-v3 --disable-sjlj-exceptions --disable-shared --disable-tls --disable-libitm --with-arch=x86-64 --with-tune=intel --with-fpmath=sse --with-multilib-list=m32,m64,mx32 --enable-initfini-array --disable-nls --with-sysroot=/home/cyborg/zenfone/androtoolx86/sysroot --with-python --with-gxx-include-dir=/home/cyborg/zenfone/androtoolx86/include/c++/4.9.x --with-bugurl=sayeed.afridi2009@gmail.com --disable-bootstrap --enable-plugins --enable-gnu-indirect-function --disable-libcilkrts --disable-libsanitizer --enable-gold --enable-threads --enable-graphite=yes --enable-eh-frame-hdr-for-static --enable-gold=default


make -j4 all
make install
cd ..
echo "all done"
echo "finishing up"
cd ~/x86_64-gcc5.3.0/bin
for f in * ; do mv "$f" "x86_64-linux-$f" ; done
echo "toolchain ready"
